<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Synergysource - Report</title>
    <link rel="icon" type="image/webp" href="/assets/s.webp" />
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="navbar"></div>
    
    <div class="container mx-auto p-4">
        <h2 class="text-xl font-semibold mb-4">User Report</h2>
        
        <form id="reportForm" class="bg-white p-4 rounded-lg shadow-md">
            <div class="flex space-x-4">
                <div class="flex-1">
                    <label for="firstName" class="block text-sm font-medium">First Name</label>
                    <input type="text" id="firstName" class="mt-1 block w-full border border-gray-300 rounded-md p-2" readonly />
                </div>
                <div class="flex-1">
                    <label for="lastName" class="block text-sm font-medium">Last Name</label>
                    <input type="text" id="lastName" class="mt-1 block w-full border border-gray-300 rounded-md p-2" readonly />
                </div>
            </div>
            <div class="mt-4">
                <label for="driverSearch" class="block text-sm font-medium">Search Driver</label>
                <input type="text" id="driverSearch" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="Enter driver name or license plate..." />
                <ul id="driverList" class="mt-2 border border-gray-300 rounded-md max-h-40 overflow-auto hidden"></ul>
            </div>
            <div class="mt-4">
                <label for="report" class="block text-sm font-medium">User Report</label>
                <textarea id="report" class="mt-1 block w-full border border-gray-300 rounded-md p-2" rows="4" placeholder="Write your report here..."></textarea>
            </div>
            <button type="submit" class="mt-4 bg-blue-500 text-white p-2 rounded-md">Submit Report</button>
        </form>
    </div>

    <script>
        // Sample driver data
        const drivers = [
            {
                license_plate: "GTB 1234",
                driver: {
                    name: "John Smith",
                    experience_years: 10,
                    rating: 4.7,
                    license_number: "GY123456"
                },
                vehicle_type: "Minibus",
                estimated_travel_time: "45 minutes"
            },
            {
                license_plate: "GTB 90",
                driver: {
                    name: "John Doe",
                    experience_years: 10,
                    rating: 4.7,
                    license_number: "GY123456"
                },
                vehicle_type: "car",
                estimated_travel_time: "45 minutes"
            }
            // Add more driver objects as needed
        ];

        // Fetch user data from localStorage and populate the form
        document.addEventListener("DOMContentLoaded", () => {
            const userData = JSON.parse(localStorage.getItem("userRegistered"));
            if (userData && userData.registered) {
                document.getElementById("firstName").value = userData.firstName;
                document.getElementById("lastName").value = userData.lastName;
            }
        });

        // Handle driver search input
        const driverSearch = document.getElementById("driverSearch");
        const driverList = document.getElementById("driverList");

        driverSearch.addEventListener("input", () => {
            const query = driverSearch.value.toLowerCase();
            driverList.innerHTML = '';
            const filteredDrivers = drivers.filter(driver => 
                driver.driver.name.toLowerCase().includes(query) || 
                driver.license_plate.toLowerCase().includes(query)
            );

            if (filteredDrivers.length > 0) {
                driverList.classList.remove("hidden");
                filteredDrivers.forEach(driver => {
                    const listItem = document.createElement("li");
                    listItem.className = "p-2 cursor-pointer hover:bg-gray-100";
                    listItem.textContent = `${driver.driver.name} - ${driver.license_plate}`;
                    listItem.onclick = () => {
                        driverSearch.value = driver.driver.name;
                        driverList.innerHTML = '';
                    };
                    driverList.appendChild(listItem);
                });
            } else {
                driverList.classList.add("hidden");
            }
        });

        // Handle form submission
        document.getElementById("reportForm").addEventListener("submit", (event) => {
            event.preventDefault();
            const report = document.getElementById("report").value;
            console.log("Driver Search:", driverSearch.value);
            console.log("Report:", report);
            // Store notification message
            localStorage.setItem('notification', 'Report submitted successfully!');

            window.location.href = '../customer_dashboard.html';


            // alert("Report submitted successfully!");
            // You can also add code here to send the report to your backend if needed
        });
    </script>

    <script>
      // Function to hide elements by ID
      function hideElementById(id) {
        const element = document.getElementById(id);
        if (element) {
          element.style.display = "none";
        }
      }

      // Function to show elements by ID
      function showElementById(id) {
        const element = document.getElementById(id);
        if (element) {
          element.style.display = "block";
        }
      }

      // Fetch the navbar and check registration status
      fetch("../navbar.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("navbar").innerHTML = data;

          // Check user registration status
          const userRegistered = JSON.parse(
            localStorage.getItem("userRegistered")
          );
          console.log("userRegistered:", userRegistered);

          if (userRegistered && userRegistered.registered) {
            hideElementById("login-link");
            hideElementById("register-link");
            showElementById("profile-link");
          }

          // Set up mobile menu toggle functionality
          document
            .querySelectorAll("[data-collapse-toggle]")
            .forEach((button) => {
              button.addEventListener("click", function () {
                const mobileMenu = document.getElementById("mobile-menu-2");
                if (mobileMenu) {
                  mobileMenu.style.display =
                    mobileMenu.style.display === "none" ||
                    mobileMenu.style.display === ""
                      ? "block"
                      : "none";
                }
              });
            });
        })
        .catch((error) => console.error("Error loading navbar:", error));
    </script>
</body>
</html>
